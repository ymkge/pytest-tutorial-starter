
-----

# 🚀 Pytest Onboarding Starter Kit

このリポジトリは、 Python のテストフレームワーク **pytest** の基本を習得し、実践的なテスト経験を積むためのスターターキットです。

## 🎯 このキットのゴール

1.  `pytest` の **インストール** と **基本実行** をマスターする。
2.  テストにおける **Fixtures**（フィクスチャ）の役割を理解し、利用する。
3.  テストの **フィルタリング** と **カバレッジ測定** を体験する。
4.  テストコードの作成に **AIツール（Geminiなど）を活用** する体験を得る。

## 🛠️ 環境構築

まず、このリポジトリをクローンし、必要なライブラリをインストールします。

```bash
# 1. リポジトリをクローン
git clone <あなたのリポジトリURL>
cd pytest-tutorial-starter

# 2. 仮想環境を作成・アクティベート (推奨)
python -m venv .venv
source .venv/bin/activate  # macOS/Linux の場合
# .venv\Scripts\activate   # Windows の場合

# 3. 必要なパッケージをインストール
pip install -r requirements.txt
```

**`requirements.txt` の内容:**

```txt
pytest
pytest-cov
```

## 👣 段階別ハンズオン・ラボ

### 段階 1: 最初のテストを書いて実行する

この段階では、最もシンプルなテストを作成し、pytest の基本的なフィードバックサイクルを体験します。

#### 1-1. テスト実行環境の確認

テストコードが一つもない状態で `pytest` コマンドを実行し、結果を確認してください。

```bash
pytest
```

> **期待される結果:** `collected 0 items` など、テストが0件であることを示すメッセージが出力されます。

#### 1-2. シンプルなテストの実装

`tests/test_calculator.py` ファイルを開き、以下の内容を追記してください。

```python
from src.calculator import add

def test_add_two_numbers():
    """2つの正の数の足し算が正しく行われるかテストする"""
    assert add(1, 2) == 3

def test_add_negative_number():
    """負の数を含む足し算が正しく行われるかテストする"""
    assert add(5, -3) == 2
```

#### 1-3. テストの再実行

テストを再度実行し、2つのテストが `PASSED` になることを確認します。

```bash
pytest
```

> **🎉 成功体験:** テストが成功し、コードが正しく動作していることが証明されました！

-----

### 段階 2: Fixtureとマーカーを使ったテスト

この段階では、より実務的なテストの書き方として、テストの準備・後処理を行う Fixture と、テストを分類する Marker を体験します。

#### 2-1. Fixture の利用

`tests/conftest.py` ファイルに `db_connection` という名前の Fixture を定義し、ダミーのデータベース接続処理をシミュレートしてください。

そして、その Fixture を利用する新しいテスト関数を `tests/test_calculator.py` に追加し、Fixture が実行されていることを確認してください。

**(💡 ヒント: Gemini CLI の活用)**
どのように Fixture を書くか迷ったら、CLIからAIに質問してみましょう。

```bash
# (例) Gemini CLI に質問してヒントを得る
gemini ask "pytestで、データベース接続をシミュレートする簡単なfixture（setup/teardown含む）をPythonで書いて"
```

#### 2-2. テストのスキップ（Marker）

`tests/test_calculator.py` に、まだ実装していない（または時間がかかる）テスト関数を作成し、`@pytest.mark.skip` デコレーターを使って**スキップ**する設定をしてください。

#### 2-3. 特定のテストのみ実行

以下のコマンドで、スキップしたテストを除外して、**マークが付いていないテストのみ**が実行されることを確認してください。

```bash
# スキップマークを除外して実行
pytest -m "not skip"
```

-----

### 段階 3: 設定ファイルとカバレッジ測定

この段階では、よりプロジェクトに統合されたテスト環境の構築を体験します。

#### 3-1. テストカバレッジの測定

以下のコマンドを実行し、どのコードがテストされたか（カバレッジ）を測定します。

```bash
pytest --cov=src --cov-report=term-missing
```

> **期待される結果:**
> `src/calculator.py` のどの行がテストで実行されなかったか（`Missing`）が表示されます。未実行のコードがあれば、段階 1 で作成したテストコードを修正して、すべての行が実行されるように挑戦してみましょう。

#### 3-2. (応用) pytest.ini の設定

このリポジトリには `pytest.ini` ファイルが用意されています。

ファイルを開き、**デフォルトのテストオプション**（例: テスト実行時に常に詳細表示 `-v` をつけるなど）を追記して、オプションを付けずに `pytest` を実行しても反映されるかを確認してください。

-----

## 🎓 完了後のステップ

このキットのすべてのステップが完了したら、あなたはもう pytest の基本的な使い手です。次のステップとして、GitHub Actions などを使って **CI (継続的インテグレーション)** の環境に組み込む方法を学びましょう。